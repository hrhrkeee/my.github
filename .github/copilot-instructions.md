<!-- ============================================================
  .github/copilot-instructions.md
  ============================================================
  【このファイルの役割】
  リポジトリ全体に適用される「常時有効なカスタムインストラクション」です。
  ワークスペース内のすべてのCopilot Chatリクエストに自動的に付加されます。

  【何を記載するか】
  - プロジェクトの概要・目的
  - 使用言語・フレームワーク・ランタイムのバージョン
  - コーディング規約（命名規則、インデント、コメントスタイルなど）
  - プロジェクトのディレクトリ構成と各フォルダの役割
  - ビルド・テスト・リントの実行方法
  - 依存関係やCI/CDパイプラインの概要

  【AIへの影響】
  - Copilot Chatがコードを生成・提案する際に、ここに書かれたルールやコンテキストが
    自動的にプロンプトに含まれます。
  - プロジェクトの慣習に沿った一貫性のあるコード生成が期待できます。
  - コードレビュー時にもこの指示が参照されます。

  【注意事項】
  - VS Code の設定 `github.copilot.chat.codeGeneration.useInstructionFiles` が
    有効になっている必要があります（デフォルトで有効）。
  - このファイルは Visual Studio、GitHub.com(Copilot coding agent) でも検出されます。
  - 長さは2ページ程度に収めることが推奨されています。
  - タスク固有の指示は書かず、プロジェクト全体に共通する内容のみ記載してください。
  ============================================================ -->

# プロジェクト概要

Pythonを使った機械学習のための新モデルの開発・構築・デプロイを行うプロジェクト。

## 技術スタック

- 言語: Python 3.11+
- パッケージマネージャー: uv（.venv でローカル管理）
- 主要ライブラリ: PyTorch, Transformers, scikit-learn, pandas, numpy, matplotlib
- ノートブック: Jupyter Notebook（.ipynb）
- コンテナ: Docker

## Python環境・パッケージ管理

- パッケージのインストールは `uv add <パッケージ名>` を使用する（pyproject.toml に記録される）
- `uv pip install` は原則使用しない（環境の再現性を最優先する）
- 開発用の依存は `uv add --dev <パッケージ名>` でインストールする
- 環境の再構築は `uv sync` で行う
- `.venv/` はリポジトリに含めない

## コーディング規約

- Pythonスクリプト・ノートブック内のコメントは日本語で記載する
- 変数名・関数名・クラス名は英語（PEP 8準拠: snake_case / PascalCase）
- ノートブックのファイル名のみ日本語を許可する（他のファイル・フォルダは英語）
- インデントはスペース4つ
- 型ヒントを積極的に使用する
- docstringはGoogleスタイルで記載する

## ディレクトリ構成

```
main.py                # エントリーポイント（ルートの唯一のPythonスクリプト）
pyproject.toml         # プロジェクト設定・依存関係（uv管理）
.env                   # 環境変数（APIキー等）
src/                   # モデル定義・学習ロジック・推論パイプライン等のソースコード
data/                  # データセット（coco_2017やcustom_dataset_v2026.1.1などサブフォルダで管理）
notebooks/             # 各種機能を試すためのJupyter Notebook（日本語ファイル名・番号付き）
util/                  # 汎用ユーティリティ関数（ロギング、可視化、評価指標など）
model_weights/         # 学習済みモデルの重みファイル（.gitignore対象）
output/                # 実行結果の出力先（YYYYMMDD-hhmmss_[task名]/ サブフォルダで管理）
temp/                  # 一時ファイル・実験用スクリプト
docker/                # Dockerfile, docker-compose.yml
test/                  # テストコード（pytest）
.github/               # Copilotカスタマイズファイル
```

## 出力フォルダの規約

- `output/` 直下にはファイルを直接出力しない
- 各実行ごとに `YYYYMMDD-hhmmss_[task名]/` のサブフォルダを作成する
- 例: `output/20260207-143025_finetune_bert/`

## ノートブックの規約

- ファイル名は日本語で記載し、先頭に実行順の番号を付ける
- 例: `01_基盤モデルを試す.ipynb`, `02_訓練データセットを用意する.ipynb`
- サニティチェックやミニマム実行を最初に行えるようにする
- 擬似データの生成によるサニティチェックを推奨する
- 必要に応じてサブフォルダ（モデル別など）を作成してよい

## ビルド・テスト

- 環境構築: `uv sync`
- テスト: `uv run pytest test/`
- リント: `uv run ruff check .`
- フォーマット: `uv run ruff format .`
- 学習実行: `uv run python main.py`

## Gitワークフロー

- プロジェクトを編集する際は、ローカルリポジトリで新規ブランチを作成する
- 変更は適切なタイミングでそのブランチにコミットする
- リモートへのpushは行わない（マージは手動で実施する）

### コミットメッセージのフォーマット

コミットメッセージは以下の形式で記載する:

```
[Agent] タイトル（1行で変更の概要を簡潔に）

詳細な説明（1行以上）
- 変更内容の詳細
- 関連する複数の変更を一緒に行った場合はその理由
- なぜこの変更が必要か
```

例:
```
[Agent] データローダーとバッチ処理の最適化

- DataLoader のワーカープロセス数を CPU コア数に最適化
- バッチサイズ計算ロジックを GPU メモリに合わせて調整
- これに伴い main.py の学習パイプラインも更新
```

### コミットの粒度

細かすぎるコミットではなく、**論理的に関連する変更をまとめてコミット**する:

- 良い例: 「モデルのこの部分を修正し、それに合わせて関連する前処理部分も修正した」→ 1コミット
- 避ける例: 1行変更するたびにコミット、または150行以上の無関係な変更を1つにまとめる
